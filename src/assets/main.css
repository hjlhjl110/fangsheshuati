@tailwind base;
@tailwind components;
@tailwind utilities;

/**
 * 医务人员专用移动端UI样式
 * 针对碎片化时间学习和单手操作优化
 */

@layer base {
  /* 移动端核心优化 */
  html {
    /* 禁用iOS点击高亮和长按菜单 */
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
    -webkit-text-size-adjust: 100%;

    /* 禁用选择和拖拽 */
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;

    /* 优化滚动性能 */
    scroll-behavior: smooth;
    overscroll-behavior: contain;
  }

  body {
    @apply bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 dark:from-dark-bg-primary dark:via-dark-bg-secondary dark:to-dark-bg-tertiary text-gray-900 dark:text-dark-text-primary;
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;

    /* 移动端触摸优化 */
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;

    /* 防止缩放和双击缩放 */
    touch-action: manipulation;

    /* 禁用橡皮筋效果 */
    overflow-y: auto;
    overscroll-behavior-y: contain;

    /* 移动端性能优化 */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
  }

  /* 允许文本选择的内容区域 */
  .selectable {
    -webkit-user-select: text;
    -moz-user-select: text;
    -ms-user-select: text;
    user-select: text;
  }

  /* 深色模式平滑过渡 */
  * {
    @apply box-border transition-colors duration-normal;
  }

  /* 移动端输入框焦点优化 */
  input, textarea, select {
    @apply outline-none;
  }

  /* 移动端按钮禁用状态优化 */
  button:disabled {
    @apply cursor-not-allowed;
  }

  /* 禁用iOS长按菜单对特定元素的影响 */
  button, a, .btn, .touch-target {
    -webkit-touch-callout: none;
    -webkit-user-select: none;
  }
}

@layer components {
  /* ===== 移动端按钮组件 ===== */
  .btn {
    @apply min-h-touch min-w-touch-lg inline-flex items-center justify-center px-4 py-3 text-sm font-medium rounded-mobile transition-all duration-fast focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation active:scale-95;
    /* 单手操作优化 - 增强触控反馈 */
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
  }

  .btn-primary {
    @apply btn bg-gradient-to-r from-primary-500 to-primary-600 text-white hover:from-primary-600 hover:to-primary-700 focus:ring-primary-500 shadow-medical hover:shadow-medical-lg transform transition-all duration-200;
  }

  .btn-secondary {
    @apply btn bg-gradient-to-r from-secondary-500 to-secondary-600 text-white hover:from-secondary-600 hover:to-secondary-700 focus:ring-secondary-500 shadow-medical hover:shadow-medical-lg transform transition-all duration-200;
  }

  .btn-success {
    @apply btn bg-gradient-to-r from-success-500 to-success-600 text-white hover:from-success-600 hover:to-success-700 focus:ring-success-500 shadow-medical hover:shadow-medical-lg transform transition-all duration-200;
  }

  .btn-warning {
    @apply btn bg-gradient-to-r from-warning-500 to-warning-600 text-white hover:from-warning-600 hover:to-warning-700 focus:ring-warning-500 shadow-medical hover:shadow-medical-lg transform transition-all duration-200;
  }

  .btn-error {
    @apply btn bg-gradient-to-r from-error-500 to-error-600 text-white hover:from-error-600 hover:to-error-700 focus:ring-error-500 shadow-medical hover:shadow-medical-lg transform transition-all duration-200;
  }

  .btn-ghost {
    @apply btn bg-transparent text-primary-500 hover:bg-primary-50 dark:hover:bg-primary-900/20 focus:ring-primary-500 border border-primary-200 dark:border-primary-800 hover:border-primary-300 dark:hover:border-primary-700 backdrop-blur-sm transition-all duration-200;
  }

  .btn-outline {
    @apply btn bg-transparent text-primary-500 hover:bg-primary-50 dark:hover:bg-primary-900/20 focus:ring-primary-500 border border-primary-300 dark:border-primary-700 hover:border-primary-400 dark:hover:border-primary-600 backdrop-blur-sm transition-all duration-200;
  }

  /* ===== 移动端卡片组件 ===== */
  .card {
    @apply bg-white/95 dark:bg-dark-bg-card/95 backdrop-blur-sm rounded-mobile-lg shadow-medical hover:shadow-medical-lg transition-all duration-fast border border-gray-100/80 dark:border-gray-800/80;
    /* 现代玻璃拟态效果 */
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  .card-interactive {
    @apply bg-white/95 dark:bg-dark-bg-card/95 backdrop-blur-sm rounded-mobile-lg shadow-medical hover:shadow-medical-lg transition-all duration-fast border border-gray-100/80 dark:border-gray-800/80 cursor-pointer active:scale-[0.98] hover:scale-[1.02] hover:shadow-xl;
    /* 现代玻璃拟态效果 */
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    /* 增强交互反馈 */
    transform-origin: center;
    will-change: transform;
  }

  .card-compact {
    @apply bg-white/95 dark:bg-dark-bg-card/95 backdrop-blur-sm rounded-mobile-lg shadow-medical hover:shadow-medical-lg transition-all duration-fast border border-gray-100/80 dark:border-gray-800/80 p-3;
    /* 现代玻璃拟态效果 */
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  .card-standard {
    @apply bg-white/95 dark:bg-dark-bg-card/95 backdrop-blur-sm rounded-mobile-lg shadow-medical hover:shadow-medical-lg transition-all duration-fast border border-gray-100/80 dark:border-gray-800/80 p-4;
    /* 现代玻璃拟态效果 */
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  .card-spacious {
    @apply bg-white/95 dark:bg-dark-bg-card/95 backdrop-blur-sm rounded-mobile-lg shadow-medical hover:shadow-medical-lg transition-all duration-fast border border-gray-100/80 dark:border-gray-800/80 p-6;
    /* 现代玻璃拟态效果 */
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  /* ===== 移动端输入组件 ===== */
  .input {
    @apply min-h-touch w-full px-3 py-3 text-sm rounded-mobile border border-gray-300 dark:border-gray-600 bg-white dark:bg-dark-bg-input focus:border-primary-500 focus:ring-2 focus:ring-primary-200 dark:focus:ring-primary-800/50 transition-colors duration-fast;
  }

  .input-error {
    @apply input border-error-500 focus:border-error-500 focus:ring-error-200 dark:focus:ring-error-800/50;
  }

  /* ===== 移动端安全区域 ===== */
  .safe-area-top {
    padding-top: env(safe-area-inset-top, 0);
  }

  .safe-area-bottom {
    padding-bottom: env(safe-area-inset-bottom, 0);
  }

  .safe-area-left {
    padding-left: env(safe-area-inset-left, 0);
  }

  .safe-area-right {
    padding-right: env(safe-area-inset-right, 0);
  }

  .safe-area-all {
    @apply safe-area-top safe-area-bottom safe-area-left safe-area-right;
  }

  /* ===== 移动端导航 ===== */
  .nav-header {
    @apply fixed top-0 left-0 right-0 z-mobile-header safe-area-top bg-white/90 dark:bg-dark-bg-primary/90 backdrop-blur-xl border-b border-gray-200/50 dark:border-gray-800/50;
    /* 增强模糊效果和透明度 */
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
  }

  .nav-bottom {
    @apply fixed bottom-0 left-0 right-0 z-mobile-header safe-area-bottom bg-white/90 dark:bg-dark-bg-primary/90 backdrop-blur-xl border-t border-gray-200/50 dark:border-gray-800/50;
    /* 增强模糊效果和透明度 */
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
  }

  /* ===== 移动端状态指示器 ===== */
  .status-indicator {
    @apply inline-flex items-center px-2 py-1 rounded-full text-xs font-medium;
  }

  .status-success {
    @apply inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-success-100 text-success-800 dark:bg-success-900/20 dark:text-success-400;
  }

  .status-warning {
    @apply inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-warning-100 text-warning-800 dark:bg-warning-900/20 dark:text-warning-400;
  }

  .status-error {
    @apply inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-error-100 text-error-800 dark:bg-error-900/20 dark:text-error-400;
  }

  .status-info {
    @apply inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400;
  }

  /* ===== 移动端进度条 ===== */
  .progress-bar {
    @apply w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden;
  }

  .progress-fill {
    @apply h-full bg-primary-500 transition-all duration-300 ease-out;
  }

  /* ===== 移动端模态框 ===== */
  .modal-overlay {
    @apply fixed inset-0 z-mobile-modal bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 safe-area-all;
  }

  .modal-content {
    @apply bg-white dark:bg-dark-bg-card rounded-mobile-xl shadow-xl max-w-sm w-full max-h-[80vh] overflow-y-auto;
  }

  /* ===== 移动端列表项 ===== */
  .list-item {
    @apply flex items-center px-4 py-3 min-h-touch touch-manipulation active:bg-gray-50 dark:active:bg-gray-800 transition-colors duration-fast;
  }

  .list-item-interactive {
    @apply list-item cursor-pointer;
  }
}

@layer utilities {
  /* ===== 移动端触摸优化 ===== */
  .touch-manipulation {
    touch-action: manipulation;
  }

  .touch-target {
    @apply min-h-touch min-w-touch;
  }

  .touch-target-lg {
    @apply min-h-touch-lg min-w-touch-lg;
  }

  /* ===== 移动端手势支持 ===== */
  .swipe-x {
    @apply touch-pan-x;
  }

  .swipe-y {
    @apply touch-pan-y;
  }

  .swipe-all {
    @apply touch-pan-y touch-pan-x;
  }

  /* ===== 移动端文本优化 ===== */
  .text-balance {
    text-wrap: balance;
  }

  .text-pretty {
    text-wrap: pretty;
  }

  /* ===== 移动端隐藏显示 ===== */
  .mobile-only {
    @apply block md:hidden;
  }

  .tablet-up {
    @apply hidden md:block;
  }

  .desktop-only {
    @apply hidden lg:block;
  }

  /* ===== 移动端交互反馈 ===== */
  .active-scale {
    @apply active:scale-95 transition-transform duration-fast;
    /* 触觉反馈模拟 */
    transform: scale(1);
    transform-origin: center;
  }

  .active-opacity {
    @apply active:opacity-80 transition-opacity duration-fast;
  }

  /* 新增：增强触控反馈效果 */
  .ripple-effect {
    position: relative;
    overflow: hidden;
  }

  .ripple-effect::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.5);
    transform: translate(-50%, -50%);
    transition: width 0.3s, height 0.3s;
  }

  .ripple-effect:active::before {
    width: 200px;
    height: 200px;
  }

  /* 新增：滑动手势优化 */
  .swipe-indicator {
    @apply absolute bottom-2 left-1/2 transform -translate-x-1/2 w-8 h-1 bg-gray-300 dark:bg-gray-600 rounded-full transition-all duration-200;
  }

  .swipe-indicator.active {
    @apply bg-primary-500 w-12;
  }

  /* ===== 移动端颜色对比度增强 ===== */
  .text-high-contrast {
    @apply text-gray-900 dark:text-white;
  }

  .text-medium-contrast {
    @apply text-gray-700 dark:text-gray-200;
  }

  .text-low-contrast {
    @apply text-gray-500 dark:text-gray-400;
  }

  /* ===== 移动端间距优化 ===== */
  .spacing-mobile {
    @apply space-y-4;
  }

  .spacing-mobile-compact {
    @apply space-y-2;
  }

  .spacing-mobile-spacious {
    @apply space-y-6;
  }
}

/* ===== 深色模式专用样式 ===== */
@media (prefers-color-scheme: dark) {
  :root {
    color-scheme: dark;
  }
}

/* 增强深色模式适配 - 医务人员夜间护眼 */
.dark {
  /* 深色模式专用渐变背景 */
  .bg-gradient-dark-medical {
    background: linear-gradient(135deg, #0a0e1a 0%, #1a1f2e 50%, #2a3444 100%);
  }

  /* 深色模式卡片玻璃效果 */
  .dark .card {
    background: rgba(30, 41, 55, 0.8);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border: 1px solid rgba(75, 85, 99, 0.3);
  }

  /* 深色模式导航栏优化 */
  .dark .nav-header,
  .dark .nav-bottom {
    background: rgba(10, 14, 26, 0.9);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border-color: rgba(75, 85, 99, 0.2);
  }

  /* 深色模式按钮优化 */
  .dark .btn-ghost {
    background: rgba(30, 41, 55, 0.5);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  /* 深色模式状态指示器优化 */
  .dark .status-indicator {
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
  }

  /* 深色模式文本对比度优化 */
  .dark .text-high-contrast {
    color: #f7fafc;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
  }

  /* 深色模式滚动条优化 */
  .dark ::-webkit-scrollbar {
    width: 4px;
  }

  .dark ::-webkit-scrollbar-track {
    background: rgba(45, 55, 72, 0.3);
  }

  .dark ::-webkit-scrollbar-thumb {
    background: rgba(113, 128, 150, 0.5);
    border-radius: 2px;
  }

  .dark ::-webkit-scrollbar-thumb:hover {
    background: rgba(160, 174, 192, 0.7);
  }
}

/* ===== 减少动画设置 ===== */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* ===== 高对比度模式支持 ===== */
@media (prefers-contrast: high) {
  .btn {
    @apply border-2 border-current;
  }

  .card {
    @apply border-2 border-gray-400 dark:border-gray-600;
  }
}

/* ===== iOS特殊处理 ===== */
@supports (-webkit-touch-callout: none) {
  /* iOS Safari特定的样式优化 */
  html {
    -webkit-appearance: none;
  }

  input[type="text"],
  input[type="email"],
  input[type="password"],
  input[type="number"],
  input[type="search"],
  textarea,
  select {
    -webkit-appearance: none;
    border-radius: 0;
  }
}